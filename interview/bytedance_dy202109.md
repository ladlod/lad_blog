# 字节抖音后端面经
## 一面(2021.9.7）
### 1. 自我介绍、项目介绍
### 2. 项目选型为什么用zset
    审核场景需要一个可靠的有序队列
### 3. zset的底层数据结构
    跳表+哈希表、压缩列表
### 4. redis的数据持久化原理，怎么选型
    rdb 另外一个线程定时持久化 特点：性能好
    aof 记录所有redis请求日志 特点：容灾好
    对数据可靠性要求高，修改频率低的用aof，可靠性要求低，修改频率高的用rdb
### 5. 项目redis选型为缓存型还是持久型
    因为是审核场景，数据需要持久化，所以是持久型
### 6. redis数据过期算法
    lru：最久未使用的先过期
    lfu：使用次数最少的先过期
    key淘汰机制：惰性过期（下次访问时判断是否过期，过期再删除）+定时删除（定时任务check过期
    的key并删除）
### 7. mysql除了分库分表优化思路
    查询慢日志，explian看是否命中索引，修改sql或优化索引
    以下情况sql无法命中索引：'!=', 'in', like以'%'开头
### 8. 令牌桶算法具体指什么
    定时向桶内匀速放入令牌，接口每次请求取出一块令牌，桶空则拒绝或延迟请求
### 9. 项目中怎么应用到的令牌桶算法
    广告匀速投放
### 10. 手撕代码
    [k个一组反转链表](https://leetcode-cn.com/problems/reverse-nodes-in-k-group/)变形，从后向前反转
    做过原题所以思路正确，但手撕链表编码过程中因为面试较紧张，边界情况没考虑清除，实现了很多
    次才ac，共用了半个小时左右，手撕代码之前面试官感觉还比较满意，之后感觉面试官脸色不太好。
### 11. 思路题
    [二叉搜索树查第k个数](https://leetcode-cn.com/problems/kth-smallest-element-in-a-bst/)
    我 中序遍历，遍历到第k次返回
    面试官 时间复杂度
    我 O(k) (此处有错误，应该是O(logn+k)，没有考虑到中序遍历需要先遍历一次树的层数)
    面试官 可以做到O(logk)吗
    我 没想到解法
    面试官 没关系，这个可以不了解
### 12. rabbit-mq的事务了解吗
    答了消息消费的ack机制，面试官问还有其它的么，实话说了对rabbit-mq原理不是很了解
### 13. mysql的索引怎么实现的，为什么不用红黑树
    b+树
    红黑树二叉，b+树多叉，搜索效率高
    红黑树节点存储数据，b+树节点不存储数据，节省空间
    b+树分片存储，范围查询性能更好
### 没有反问环节，直接结束面试，总结
    面试的部门不是做广告的，项目经历面试官不了解，没有深入挖。
    手撕代码虽然做过原题，但是手撕链表不熟悉，做的太慢，对面试评分有很大影响。
    面试当天晚上hr反馈面试通过。
    
## 二面(2021.9.9）
### 1.自我介绍、项目介绍
### 2.审核系统的派单具体怎么实现的
    讲了为什么选型zset，派单是从队列拉数据，并定期check回捞审核元素
### 3.你这个审核系统中排序的key是时间戳，如果我想再加一个按照优先级排序呢
    我：最开始没明白面试官问题，回答可以把高优的广告时间戳按比例减小，排在最前面。
    面试官：这样不就打乱原有顺序了么。
    我：哦哦，问题的意思是相同优先级的key按照时间排序，不同优先级的key按照优先级排序是吧。
    面试官：是的。
    我：那可以把key拆成两部分，高32位存储优先级，低32位存储时间戳
    面试官：可以的，是一种实现方案，那如果再加一个排序条件呢？（这个地方应该是对我的项目选型
    不满意）
    我：想不到解法了
    面试官：可以开放一下思路，不用redis了
    我：可以用mongo去存储队列，审核人员拉取的时候同时更新行，给该行加锁
    面试官：这种设计会有并发问题么
    我：mongo的findandmodify方法是原子性的，不会有并发问题
    面试官：可以的，这也是一种实现方案，还有更优的么。
    我：暂时想不到了。
### 4.项目选型redis，有考虑过redis的可靠性问题么
    我：业务场景对可靠性要求不高，一条广告如果从队列丢失了，下次还可以再进来
    面试官：那redis如果宕机，数据会丢失么
    我：在rdb持久化模式下，如果redis宕机，会丢失这期间还未持久化的数据，已持久化的数据不会
    丢失
    面试官：rdb存储的文件数据格式是怎样的
    我：猜测是二进制文件，具体不了解
    面试官：那redis的分布式数据怎么同步的
    我：定期从主节点同步
    面试官：是增量还是全量呢
    我：增量（此处错误，首次同步是全量、之后是增量）
    面试官：那redis的分片了解么
    我：应该是对key求hash来分片（猜的，不知道对不对）
    面试官：那求hash的过程可能会出现分布不均的问题啊，怎么解决
    我：可以将hash上所有的节点组成一个环，叫什么算法来着（想不起来叫什么了，面试官提示叫一致
    性哈希算法）
    面试官：那假如只有三个节点，还是可能出现分布不均的情况啊
    我：可以引入虚拟节点
### 5.看你们物料存储用的都是mongo啊，mongo对比mysql有哪些区别呢
    我：mongo存储文件，表结构更灵活，mysql支持关系型存储，可以连表查询，支持事务，mongo不
    具有关系型
    面试官：还有呢
    我：不了解了
### 6.go在多个协程读写同一个变量的时候，会产生什么问题，怎么解决
    我：会出现写丢失，重复读，幻读等问题
    面试官：怎么解决呢
    我：对读操作加读写锁，写操作加写锁（此处说反了，应该是读加写锁，写加读写锁，被面试官指正
    了一下）
    面试官：那写锁和读写锁是怎么实现的呢
    我：加写锁的时候可以获取写锁，不可以获取写锁。加读写锁，写锁和读写锁均不能获取
    面试官：有没有不加锁的方式
    我：atomic包？不过这个包里面应该也用到了锁
    面试官：有了解过乐观锁么
    我：哦哦，了解，但是实际业务场景上应用的不多，因为乐观锁修改失败的时候会出现报错
    面试官：那悲观锁就不会报错么
    我：悲观锁获取不到的时候可以等待锁，直到获取到
    面试官：乐观锁报错也可以重试啊
    我：是的哈哈哈，没考虑到
### 7.手撕代码
    二叉树任意两个结点的距离，并自己写一些测试用例
    先说思路：先找到两个节点的最近公共祖先(https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/)之后求这两个节点到公共祖先的距离的和
    手撕代码：这个地方因为做过寻找公共祖先原题，很快就写好了，但是因为牛客的网站没有二叉树初
    始化之类的方法，手写了一套二叉树根据数组初始化及先序遍历，20分钟左右全部完成
    这个地方面试官比较满意，说看得出来代码功底不错
### 8.反问
    我：想了解一下本次面试的部门具体的业务方向
    面试官：不好意思这个我也不太了解
    我：嗷嗷，是交叉面啊哈哈哈
    我：那面试官可以给我提一些建议么
    面试官：建议还是有一些的，可以看的出来你对业务的理解还是不错的（讲审核项目的时候讲了业务
    的瓶颈），代码功底也不错（手撕代码一遍过，而且多实现了一些），但是基础知识部分还要再多了
    解了解，比如redis的分布式部署啊，mysql和mongo的区别啊，那我现在问你，对于一行数据的搜
    索用哪个效率更高
    我：mongo更高，因为mongo是聚簇索引，mysql是非聚簇索引，需要回表查一次
    面试官：嗷嗷，对，数据库索引这块儿忘记问你了，那mongo的索引是怎么实现的呢，范围查找哪个
    效率更高
    我：mongo的索引没了解过，mysql的索引是b+树，范围查找效率会高一些
    面试官：对，这些基础的东西你还是要多了解一下，还有你的项目选型其实并不是最优的，可以多思
    考思考优化手段，redis并不适合做审核队列来用，你现在毕业是一年吧
    我：嗯嗯，是一年
    面试官：一年，确实还可以再多了解了解（这个地方感觉像是劝退了），那我们今天的面试就到这里
    我：好的，谢谢面试官，再见
### 总结
    首先，手上的几个项目最适合拿来面试讲的其实是品牌广告项目，涉及到推荐和召回相关的一些简单
    架构，并发量也不小，但自我介绍的时候重点讲了审核系统以及数据库分表，主要是考虑到这个地方
    用到的基础知识点更多一些，给面试官可问的话题较多，以免问到我不擅长的地方。但这个项目本身
    是刚刚毕业的时候做的，项目的技术方案到技术选型都不是很合理，所以单拿项目来说并没有亮点。
    其次，对常用的基础技术栈redis，mongo，mysql只突击了面试常问到的八股文，没有深入理解，
    面试官一深挖就暴露了。并且对一些自己背过的东西在回答的时候面试官质疑一下就会紧张，怀疑自
    己背过的，没法给出确定的答案，在面试的时候也是一个扣分点。自己在平时做项目的时候，很少去
    了解技术栈的底层原理，只到了面试前才突击了解，在面试时很容易暴露问题，一深挖就答不上，一
    个问题答不上会连动后面的问题都由于紧张等原因大脑短路。并且对现有系统的优化没有深入思考，
    知道现有结构的不足，但没有优化的想法，可以整理出来优化的想法，无需落地，以备面试时作为亮
    点来使用。
    本次面试整体发挥和一面差不多，面试官项目细节深挖了一些暴露了很多不足，对面试评分有较大影
    响。但好在手撕代码环节发挥的不错，很快就ac并且做了一些冗余的工作挽回了一些印象分。
    面试当天晚上hr反馈面试通过。
    
## 三面(2021.9.15)
### 1.自我介绍、项目介绍
    因为是三面，所以没有把项目全部拿出来说，挑了几个比较有技术挑战的或是业务有思考的重点介绍
    了一下。
### 2.手撕代码，二维有序数组归并排序
    先说思路，常规归并排序时间复杂度O(mn)，可以使用堆来存数组，优化时间复杂度到O(mlogn)，
    因为手撕了一个堆，用的时间稍微久了一点，大概20min。
### 3.思路题
    数组的度为最多相同元素的个数，求最短连续子数组，使得数组的度等于原数组
    eg：[1, 2, 2, 3, 1]  #[2,2]
        [1,2,2,3,1,4,2] #[2,2,3,1,4,2]
    说了思路，一次扫描用一个map[int]sturct{l,r,cnt}来存储每个数字出现的最左，最右，以及
    次数，二次扫描找出cnt最大且r-l最小的，感觉可能不是最优解。
### 4.思路题
    找出二叉树最长路径
    递归遍历树，判断左子树最大深度+右子树最大深度是否大于当前最大值，大于则更新，同时返回该
    节点的最大深度为左右子树最大深度+1
### 5.思路题
    判断一个括号字符串第一次非法的位置
    eg: [ ( ( ( ) ) ( ) ）】 res: 在 )()位置非法
    用一个栈记录出现过的括号，左括号入栈，右括号出栈，如果出栈元素与右括号不对应或栈空，则非
    法
    那如果在字符串中加上*呢，*可以匹配任意括号
    暴力做法，可以用一次dfs扫描
    时间复杂度太高了，有优化手段么
    可以用动态规划，大概思路，每次遇到 '*' dp[i] = dp[i-1]|dp[i-3]|...
    不知道思路是否正确，面试官说不用说了
### 6.挑一个项目中遇到的最难点讲一下吧
讲了关于数据库缓存一致性的研究，具体在[数据库缓存一致性问题](common/cache_coherency.md)中有记录。
### 7.那redis的底层原理应该比较清楚了，持久化方式及特点说一下
    讲了rdb和aof，以及rdb的优势是性能高，劣势是容灾差，aof的优势是容灾好，性能差
### 8.有没有可能rdb和aof一起用呢
    在redis4.0引入了rdb和aof共用的机制
### 9.你是读过redis源码吗
    嗯，读过hash相关的源码，讲了redis rehash的机制，渐进式rehash及rehash时机，每100ms
    的第一ms进行rehash等细节，这块儿主要是为了证明我确实读过源码，但其实这部分介绍的不是很
    好，没有讲出redis设计的精妙之处。
### 10.还有其它的读过吗，看你用过zset，知道数据结构吗
    zset用跳表+hashmap以及压缩列表实现，压缩列表就指的是[1,2,3,4,5]->[1,4]这种形式
### 11.什么时候在两种类型之间切换了解吗
    这个不了解，我猜测应该和bitmap的container切换实际差不多，每次插入数据的时候检测一次。
### 12.你这边一般是接pm需求还是从montor那儿拿需求
### 13.需求都是来自外部吗
### 14.一般怎么做排期
### 15.有过delay的情况吗
### 16.有什么要问我的吗
    了解了一下业务方向和技术栈
### 总结
    三面相对来说更考察思路和技术深度，没有严扣八股文，了解了些工作技能。
    面试十五分钟之后hr就约了hr面。